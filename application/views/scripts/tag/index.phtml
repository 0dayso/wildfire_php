<link rel="stylesheet" type="text/css" media="screen" href="<?php echo $this->baseUrl();?>/css/sns.css" />

<div class="span10">
  <div style="padding-left:15px" class="nav" id="folders">

  </div>
</div>


<div class="span10 topics">
	<div class="loadingtopic" style="display: none">读取中...</div>
</div>


<script type="text/template" id="tag_template">
	<li><a href="javascript:void(0);" rel="<%= topic_num%>"><%= name%></a></li>
</script>

<script src="<?php echo $this->baseUrl();?>/js/backbone/tags/tag.js"></script>

<script type="text/javascript">
_totalPage = 0;
_currentPage = 0;
_selectKey = null;
_totalCount = 0;
_loading = false;
jQuery(function($){
	//$('#tagCloudDiv').tagcloud({centrex:400, centrey:300, init_motion_x:10, init_motion_y:10,zoom: 100,max_zoom: 100,min_zoom: 100});
	$(window).bind("scroll",function(){
		if(_selectKey){
			if(_totalPage>0&&_currentPage<_totalPage){
				var top = document.documentElement.scrollTop + document.body.scrollTop;
				if($(".topics").height() - top < 500){
					if(!_loading){
						openDetail(_selectKey,_totalCount,++_currentPage);
					}
				}
			}
		}
	});
});

function getTopics(key,count,page){

}
function openIssues(e){
	var description = jQuery("<div class='issuedetail'>"+jQuery(e).attr("description")+"</div>");
	var topic = jQuery(e).attr("data");
	var issue = jQuery(e).attr("issue");
	var button = jQuery("<button class='btn btn-primary'>领取</button>").bind("click",function(){getIssue(topic,issue)});
	jQuery(".topics").html(description).append(button);
	
}
function getIssue(topic,issue){
	jQuery(".topics").html("读取中...");
	jQuery.post("tag/ajaxgetissue",{issue:issue},function(){
		jQuery.get("tag/ajaxissuedetail?key="+topic,function(data){
			jQuery(".topics").html(data);
		});
	});
}



// backbone app
      window.AppView = Backbone.View.extend({

        el: $("#inbox"),

        events: {

        },

        initialize: function() {
        	<?php foreach($this->topicsUntaggedSumByFolder as $topicsUntaggedByFolder):?>
        	var tag = new Tag({
                name:'<?php echo $topicsUntaggedByFolder['key']?>',
                topic_num :'<?php echo $topicsUntaggedByFolder['value']?>'
              });
        	tags.add(tag);
        	var view = new TagView({model: tag});
        	jQuery("#folders").append(view.render().el);
        	
       		<?php endforeach;?>
        },

        render: function() {
        }

      });

      window.App = new AppView;


</script>
