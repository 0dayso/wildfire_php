<link rel="stylesheet" type="text/css" media="screen" href="<?php echo $this->baseUrl();?>/css/sns.css" />

<div class="span11">
  <div style="padding-left:15px" class="nav" id="folders">

  </div>
</div>

<div class="filters">
  <div><a><span class="badge filter" onclick="filter('');return false;">all</span></a></div>
  <div><a><span class="badge badge-success filter" onclick="filter('.alert-success');return false;">conversation</span></a></div>
  <div><a><span class="badge badge-warning filter" onclick="filter('.alert-warning');return false;">product</span></a></div>
  <div><a><span class="badge badge-important filter" onclick="filter('.alert-error');return false;">mission</span></a></div>
</div>

<div class="modal hide">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal">×</button>
		<h3>Insert the image url</h3>
	</div>
	<div class="modal-body">
		<label class="control-label">亲，记得带上这个链接哦...</label>
		<textarea class="input-xlarge" id="text" rows="2" style="width:500px;"></textarea>
	</div>
</div>


<script type="text/template" id="container_template">
	<div class="loadingtopic" style="display: none">读取中...</div>
</script>


<script type="text/template" id="tag_template">
	<li><a href="javascript:void(0);" rel="<%= topic_num%>"><%= name%></a></li>
</script>

<script type="text/template" id="topic_template">
<% if(read){ %>
	<div class="topic span4 isotope-item alert alert-<%= type %> read" data="<%= id %>">
<%}else{ %>
<div class="topic span4 isotope-item alert alert-<%= type %>" data="<%= id %>">
<%} %>
		<div style="width:100%;" class="topic_head">
			<div style="" class="title_td">
				<div class="row-fluid">
					<div class="span11">
						<i class="babytree" style=""></i>
						<span class="title"> 
              <div class="author">
                <img style="width:50px;height:50px;" src="<%= author.profile_img %> "/><br> <%= author.name %>
              </div>
              <a href="javascript:void(0)">
                <% if (_.isEmpty(title)) {%> <%= body %> <%} else { %><%= title %> <%} %>
              </a>
            </span>
            <br />           
          	<button class="btn reply_window">
						  我要回复
						</button>            
					</div>
			        <div span="span2">
			        	<i class="icon-zh-CN" style="float:right"></i>
			        </div>
				</div>
				<div style="display: none;" class="topicPRR">
			    	<div class="posts"><div>Loading...</div></div>
			        <div class="responses">
			        </div>
			        <div class="reply" id="reply_box_1">
						<form action="">
						    <textarea placeholder="在这里填写您想回复的话" style="width:90%" rows="4" class="reply-content"></textarea>
						    <button id="" class="btn btn-primary add-url">添加原帖链接</button>
						<img id="submit_button_1" class="weibo-reply-img" style="cursor:pointer;padding-bottom: 10px;" src="<?php echo $this->baseUrl();?>/images/weiboreply.gif"></img>
						</form>
					</div>
				</div>
			</div>
		</div>
		
		
	</div>
</script>
<script type="text/template" id="posts_template">
<% var length = models.length;var hiddenFormat=false;var index = 0;if(length>5){hiddenFormat=true}; %>
<%  _.each(models, function(post){ %>
<% if(hiddenFormat && index>0 && index< length-1){ %>
<div class="post row-fluid" style="display:none">
<%}else{ %>
<div class="post row-fluid">
<%} %>

	<div class="head span1">
		<div style="vertical-align: top; margin-left: 0px;">
			<img src='<%= post.get("profile_img_path") %>' />
			<a><%= post.get("username")%></a>
		</div>
	</div>
	<div class="span10">
		<div class="author"></div>
		<br>
		<div class="body">
			<table>
				<tbody>
					<tr>
                        <% if (post.get("body").length<50) {%>
						<td><%= post.get("body") %></td>
                        <%}else{ %>
						<td><%= post.get("body").substring(0,50) %>...</td>
                        <%} %>                      
					</tr>
				</tbody>
			</table>
		</div>
		<div class="body_translated"></div>
		<div class="date"><%=post.get("date")%></div>
	</div>
</div>
<% if(hiddenFormat && index == 2){ %>
<div class="post posthidden"></div>
<div class="post posthidden showHiddenPost" style="cursor:pointer;text-align:center;"><span><%= length-2 %> More</span></div>
<div class="post posthidden"></div>
<% } %>
<% index ++;%>
<% }); %>
</script>
<script src="<?php echo $this->baseUrl();?>/js/backbone/tags/post.js"></script>
<script src="<?php echo $this->baseUrl();?>/js/backbone/tags/topic.js"></script>
<script src="<?php echo $this->baseUrl();?>/js/backbone/tags/tag.js"></script>

<script type="text/javascript">

function filter(category){
	jQuery(".topics").isotope({filter:category});
}

function getTopics(key,count,page){

}
function openIssues(e){
	var description = jQuery("<div class='issuedetail'>"+jQuery(e).attr("description")+"</div>");
	var topic = jQuery(e).attr("data");
	var issue = jQuery(e).attr("issue");
	var button = jQuery("<button class='btn btn-primary'>领取</button>").bind("click",function(){getIssue(topic,issue)});
	jQuery(".topics").html(description).append(button);
	
}
function getIssue(topic,issue){
	jQuery(".topics").html("读取中...");
	jQuery.post("tag/ajaxgetissue",{issue:issue},function(){
		jQuery.get("tag/ajaxissuedetail?key="+topic,function(data){
			jQuery(".topics").html(data);
		});
	});
}



// backbone app
      window.AppView = Backbone.View.extend({

        el: jQuery("#inbox"),

        events: {

        },

        initialize: function() {
        	<?php foreach($this->topicsUntaggedSumByFolder as $topicsUntaggedByFolder):?>
        	var tag = new Tag({
                name:'<?php echo $topicsUntaggedByFolder['key']?>',
                topic_num :'<?php echo $topicsUntaggedByFolder['value']?>'
              });
        	tags.add(tag);
        	var view = new TagView({model: tag});
        	jQuery("#folders").append(view.render().el);
        	
       		<?php endforeach;?>
       		this.container = new ContainerView({});
       		jQuery(".filters").after(this.container.render().el);
       		this.container.layout();
       		
        },

        render: function() {
        }

      });

      window.App = new AppView;


</script>
